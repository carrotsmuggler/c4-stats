#!/usr/bin/env python3

import sys
import subprocess

if len(sys.argv) > 1:
  warden=sys.argv[1]
else:
  print("Usage: c4-stats <warden>")
  exit(1)

process = subprocess.run("rm -f findings.csv".split(), stdout=subprocess.PIPE)

cmd = "wget -q https://raw.githubusercontent.com/code-423n4/code423n4.com/main/_data/findings/findings.csv"
subprocess.run(cmd, shell=True, stdout=subprocess.PIPE)


cmd = f"cat findings.csv | grep '{warden}' | awk 'BEGIN {{ FS=\",\" }}  {{ print $1 }}' | sort | uniq  | wc -l"
p = subprocess.Popen(cmd, shell=True, stdout=subprocess.PIPE)
output, error = p.communicate()
numContests = int(output.strip().decode("UTF-8"))

if numContests > 0:
  print(f"{warden} contests: {numContests}")
else:
  print(f"{warden} has not competed")


